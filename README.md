# Thoughtsy

Simple portfolio CRUD SPA web app that allows users to share their words of wisdom with others.
Created with React 18, React Router 6.4, React Hook Form 7.4 and Material UI 5.
Testing environment includes Vitest + React Testing Library
Used libraries and dependencies are React 18.2, React Router 6.4, React Hook Form 7.4 and Material UI 5.
Supabase was used as back-end.

## Available functionality

1. Handling user log in, log out and post fetching
2. Registration with email verification

## Instalation and configuration

1. Fork repo
2. Create your own Supabase project, go to SQL Editor and set up tables as follows:

```
create table
  public.users (
    uid uuid not null,
    display_name character varying not null,
    created_at timestamp without time zone null default (now() at time zone 'utc'::text),
    constraint users_pkey primary key (uid)
  ) tablespace pg_default;
create table
  public.posts (
    id bigint generated by default as identity,
    content character varying null,
    type character varying null,
    source character varying null,
    uid uuid null,
    created_at timestamp with time zone not null default now(),
    constraint thoughts_pkey primary key (id),
    constraint posts_id_key unique (id),
    constraint posts_uid_fkey foreign key (uid) references users (uid)
  ) tablespace pg_default;
create table
  public.post_likes (
    id bigint generated by default as identity,
    uid uuid null,
    post_id bigint not null,
    created_at timestamp with time zone not null default now(),
    constraint post_likes_pkey primary key (id),
    constraint post_likes_post_id_fkey foreign key (post_id) references posts (id)
  ) tablespace pg_default;
```

3. In Supabase, go to Authentication tab, then in Policies create new policies for table actions:

```
create policy "Profiles are viewable by everyone."
  on users for select
  using ( true );

create policy "Users can insert their own profile."
  on users for insert
  with check ( auth.uid() = id );

create policy "Users can update own profile."
  on users for update
  using ( auth.uid() = id );

create policy "Posts are viewable by everyone."
  on posts for select
  using ( true );

create policy "Post likes are viewable by everyone."
  on post_likes for select
  using ( true );
```

4. Create a test user for tests assertion (Authentication tab in Supabase)
5. Execute `npm i` to install dependencies
6. You need to create `.env` file with these variables:

```
VITE_SUPABASE_KEY=supabase_key
VITE_SUPABASE_SITE=supabase_site
VITE_SUPABASE_TEST_EMAIL=test@user.com
VITE_SUPABASE_TEST_PASSWORD=123
VITE_TEST_SIGN_UP=0
VITE_SUPABASE_SIGNUP_EMAIL=actual@email.com
VITE_SUPABASE_SIGNUP_DISPLAY_NAME=e2eTestUser
VITE_SUPABASE_SIGNUP_PASSWORD=123456
```

7. Add a trigger in Supabase SQL Editor to insert into users table a user after signing up:

```
create or replace function public.handle_new_user()
returns trigger as $$
begin
  insert into public.users (uid)
  values (new.id);
  return new;
end;
$$ language plpgsql security definer;
create or replace trigger on_auth_user_created
  after insert on auth.users
  for each row execute procedure public.handle_new_user();
```

8. Execute `npm run test` to start tests to check all functionality.

> **Testing sign up**: Please note that while testing sign up Supabase sends a standard verification e-mail.
> You should turn off that setting while testing in Authentication tab -> Providers -> Email -> Confirm email

> To disable or enable sign up integration test you can change `VITE_TEST_SIGN_UP` to _0_ or _1_

## Used materials

### Used React Router 6.4 tutorial and docs: https://reactrouter.com/en/main/start/tutorial

### Used MUI documentation: https://mui.com/material-ui/getting-started/learn/

### React Hook Form 7.4: https://react-hook-form.com/get-started#Quickstart
